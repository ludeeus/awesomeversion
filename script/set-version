#!/bin/sh

# script/set-version: Update the version in pyproject.toml

set -e

cd "$(dirname "$0")/.."

# Check if version argument is provided
if [ -z "$1" ]; then
    echo "Error: Version argument is required"
    echo "Usage: script/set-version <version>"
    echo "Example: script/set-version 1.2.3"
    exit 1
fi

VERSION="$1"

# Validate version format (basic check)
if ! echo "$VERSION" | grep -E '^[0-9]+\.[0-9]+\.[0-9]+' > /dev/null; then
    echo "Warning: Version '$VERSION' does not follow semantic versioning format (x.y.z)"
    echo "Continuing anyway..."
fi

echo "==> Updating version to $VERSION..."

# Update version in pyproject.toml
if [ -f "pyproject.toml" ]; then
    # Use sed to replace the version line
    sed -i "s/^version = .*/version = \"$VERSION\"/" pyproject.toml
    echo "==> Updated pyproject.toml"
else
    echo "Error: pyproject.toml not found"
    exit 1
fi

# Verify the change
if grep -q "version = \"$VERSION\"" pyproject.toml; then
    echo "==> Version successfully updated to $VERSION"
else
    echo "Error: Failed to update version"
    exit 1
fi
